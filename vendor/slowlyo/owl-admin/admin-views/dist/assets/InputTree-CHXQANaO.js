import{t as q,l as m,bk as Be,c9 as He,ca as Pe,al as Ue,am as ze,aF as M,c1 as $e,bJ as Q,z as C,bm as W,G as j,H as L,a4 as x,cb as Ge,ag as B,aO as Je,w as Me,x as Qe,cc as We,bR as Y,ad as Ye,P as qe,ae as Ke,D as f,Q as _,T as s,ap as Xe,br as Ze,cd as et,ah as tt,Y as it}from"./index-CEmnTf-r.js";var rt=function(E){q(o,E);function o(e){var t=this,i;return t=E.call(this,e)||this,t.rootRef=m.createRef(),t.state={keyword:"",filteredOptions:(i=t.props.options)!==null&&i!==void 0?i:[],allowSearch:!1,virtualListHeight:0,treeHeight:0},t.handleSearch=Be(t.handleSearch.bind(t),250,{trailing:!0,leading:!1}),t}return o.prototype.componentDidMount=function(){var e=this,t,i=(t=this.rootRef.current)===null||t===void 0?void 0:t.parentElement;this.handleHeight(),this.unSensor=He(i,function(){e.handleHeight()},!1,"height")},o.prototype.handleHeight=function(){var e;if(this.props.heightAuto)this.setState({treeHeight:0});else{var t=(e=this.rootRef.current)===null||e===void 0?void 0:e.parentElement,i=this.treeRef.root.current,r=t.offsetHeight-Pe(t,i);this.setState({treeHeight:r})}},o.prototype.componentDidUpdate=function(e){var t=this.props,i=this.state.keyword;if(e.options!==t.options||e.searchable!==t.searchable){var r=t.options,a=t.searchable;this.setState({filteredOptions:a&&i?this.filterOptions(r,i):r})}Ue(["label","searchable","creatable","hideRoot","themeCss","wrapperCustomStyle","heightAuto"],e,t)&&this.handleHeight()},o.prototype.componentWillUnmount=function(){this.unSensor&&(this.unSensor(),delete this.unSensor)},o.prototype.reload=function(e,t){var i=this.props.reloadOptions;i&&i(e,t)},o.prototype.doAction=function(e,t,i){var r,a,l,n,u,d,p,c,h,F,g,T=e==null?void 0:e.actionType,y=this.props,A=y.resetValue,v=y.onChange,b=y.formStore,S=y.store,O=y.name;if(T==="clear")v==null||v("");else if(T==="reset"){var I=(a=ze((r=b==null?void 0:b.pristine)!==null&&r!==void 0?r:S==null?void 0:S.pristine,O))!==null&&a!==void 0?a:A;v==null||v(I??"")}else e.actionType==="expand"?this.treeRef.syncUnFolded(this.props,(l=e.args)===null||l===void 0?void 0:l.openLevel):e.actionType==="collapse"?this.treeRef.syncUnFolded(this.props,((n=e.args)===null||n===void 0?void 0:n.closeLevel)||0):e.actionType==="add"?this.addItemFromAction((u=e.args)===null||u===void 0?void 0:u.item,(d=e.args)===null||d===void 0?void 0:d.parentValue):e.actionType==="edit"?this.editItemFromAction((p=e.args)===null||p===void 0?void 0:p.item,(c=e.args)===null||c===void 0?void 0:c.originValue):e.actionType==="delete"?this.deleteItemFromAction((h=e.args)===null||h===void 0?void 0:h.value):e.actionType==="reload"?this.reload():T==="search"&&(this.setState({allowSearch:!!(!((F=e.args)===null||F===void 0)&&F.keyword)}),this.handleSearch((g=e.args)===null||g===void 0?void 0:g.keyword))},o.prototype.resolveOption=function(e,t){var i=this;return M(e,function(r){var a=i.props.valueField||"value",l=Q(r,a)?r[a]:"";return l===t})},o.prototype.addItemFromAction=function(e,t){var i=this.props,r=i.onAdd,a=i.options,l=i.valueField,n=$e(a,function(u){var d=l||"value",p=Q(u,d)?u[d]:"";return p===t})||[];r&&r(n.concat(0),e,!0)},o.prototype.editItemFromAction=function(e,t){var i=this.props,r=i.onEdit,a=i.options,l=this.resolveOption(a,t);r&&l&&r(C(C({},e),{originValue:t}),l,!0)},o.prototype.deleteItemFromAction=function(e){var t=this.props,i=t.onDelete,r=t.options,a=this.resolveOption(r,e);i&&a&&i(a)},o.prototype.filterOptions=function(e,t){var i=this,r=this.props,a=r.labelField,l=r.valueField;return e.map(function(n){if(n=C({},n),n.visible=!!W([n],t,{keys:[a||"label",l||"value"],threshold:W.rankings.CONTAINS}).length,!n.visible&&n.children){n.children=i.filterOptions(n.children,t);var u=n.children.filter(function(d){return d.visible}).length;n.visible=!!u}return n.visible&&(n.collapsed=!1),n})},o.prototype.handleChange=function(e){return j(this,void 0,void 0,function(){var t,i,r,a,l,n,u,d,p,c,h,F,g,T,y,A,v,b;return L(this,function(S){switch(S.label){case 0:return t=this.props,i=t.onChange,r=t.searchable,a=t.options,l=t.dispatchEvent,n=t.multiple,u=t.delimiter,d=t.valueField,p=t.selectedOptions,c=t.joinValues,h=t.extractValue,F=this.state,g=F.filteredOptions,T=F.allowSearch,y=r||T?g:a,A=et(e,{multiple:n,delimiter:u,valueField:d,options:g}),v=n?null:A[0],n&&(r||T)&&p.length&&(p.forEach(function(O){var I=M(g,function(D){return D[d||"value"]===O[d||"value"]});I||A.push(O)}),e=A.map(function(O){return h||c?O[d||"value"]:O}),c&&(e=e.join(u||","))),[4,l("change",tt(this.props,{value:e,item:v,items:y,selectedItems:A}))];case 1:return b=S.sent(),b!=null&&b.prevented?[2]:(i&&i(e),[2])}})})},o.prototype.handleNodeClick=function(e){return j(this,void 0,void 0,function(){var t,i,r,a;return L(this,function(l){switch(l.label){case 0:return t=this.props,i=t.dispatchEvent,r=t.data,[4,i("itemClick",x(r,{item:e}))];case 1:return a=l.sent(),a!=null&&a.prevented?[2]:[2]}})})},o.prototype.handleSearch=function(e){return j(this,void 0,void 0,function(){var t,i,r,a,l,n,u,d,p,c;return L(this,function(h){switch(h.label){case 0:if(t=this.props,i=t.searchApi,r=t.options,a=t.env,l=t.data,n=t.translate,u=[],!it(i))return[3,5];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,a.fetcher(i,x(l,{term:e}))];case 2:if(d=h.sent(),!d.ok)throw new Error(n(d.msg||"networkError"));if(p=d.data.options||d.data.items||d.data,!Array.isArray(p))throw new Error(n("Tree.invalidArray"));return u=p,[3,4];case 3:return c=h.sent(),a.isCancel(c)||!i.silent&&a.notify("error",c.message),[3,4];case 4:return[3,6];case 5:e&&(u=this.filterOptions(r,e)),h.label=6;case 6:return this.setState({keyword:e,filteredOptions:e?u:r}),[2]}})})},o.prototype.domRef=function(e){this.treeRef=e},o.prototype.validate=function(){var e=this.props,t=e.value,i=e.minLength,r=e.maxLength,a=e.delimiter,l=Array.isArray(t)?t:(t?String(t):"").split(a||",");if(i&&l.length<i)return"已选择数量低于设定的最小个数".concat(i,"，请选择更多的选项。");if(r&&l.length>r)return"已选择数量超出设定的最大个数".concat(r,"，请取消选择超出的选项。")},o.prototype.renderOptionItem=function(e,t){var i=this.props,r=i.menuTpl,a=i.render,l=i.data;return a("option/".concat(t.index),r,{data:x(x(l,C({},t)),e)})},o.prototype.renderItemActions=function(e,t){var i=this.props,r=i.itemActions,a=i.data,l=i.render;return l("action/".concat(t.index),r||"",{data:x(x(a,C({},t)),e)})},o.prototype.renderSearch=function(){var e=this.props,t=e.classPrefix,i=e.searchConfig,r=e.mobileUI,a=e.testIdBuilder;return m.createElement(Ge,C({className:B("".concat(t,"TreeControl-searchbox"),i==null?void 0:i.className,{"is-sticky":i==null?void 0:i.sticky}),mini:!1,clearable:!0},Je(i,"className","sticky"),{onSearch:this.handleSearch,mobileUI:r,testIdBuilder:a==null?void 0:a.getChild("search")}))},o.prototype.render=function(){var e=this.props,t=e.className,i=e.treeContainerClassName,r=e.classPrefix,a=e.value,l=e.enableNodePath,n=e.pathSeparator,u=n===void 0?"/":n,d=e.disabled,p=e.joinValues,c=e.extractValue,h=e.delimiter,F=e.placeholder,g=e.options,T=e.multiple,y=e.valueField,A=e.initiallyOpen,v=e.unfoldedLevel,b=e.withChildren,S=e.onlyChildren,O=e.onlyLeaf,I=e.loading,D=e.hideRoot,K=e.rootLabel,X=e.autoCheckChildren,Z=e.autoCancelParent,ee=e.cascade,te=e.rootValue,ie=e.showIcon,re=e.showRadio,ae=e.showOutline,oe=e.onAdd,ne=e.creatable,le=e.createTip,se=e.addControls,de=e.onEdit,ue=e.editable,pe=e.editTip,he=e.editControls,ce=e.removable,ve=e.removeTip,me=e.onDelete,fe=e.rootCreatable,ge=e.rootCreateTip,ye=e.labelField,be=e.iconField,Ce=e.deferField,Fe=e.nodePath,Te=e.deferLoad,Ae=e.expandTreeOptions,H=e.translate,Oe=e.data,_e=e.virtualThreshold,P=e.itemHeight,Se=e.loadingConfig,Ie=e.menuTpl,Ee=e.enableDefaultIcon,R=e.searchable,U=e.searchConfig,V=U===void 0?{}:U,we=e.heightAuto,xe=e.mobileUI,w=e.testIdBuilder,Re=e.nodeBehavior,ke=e.itemActions,z=e.id,Ne=e.wrapperCustomStyle,$=e.themeCss,De=e.env,k=this.props.highlightTxt,N=this.state,Ve=N.filteredOptions,je=N.keyword,G=N.allowSearch,Le=N.treeHeight;Me(k)&&(k=Qe(k,Oe));var J=m.createElement(We,{classPrefix:r,onRef:this.domRef,labelField:ye,valueField:y,iconField:be,deferField:Ce,disabled:d,onChange:this.handleChange,onHandleNodeClick:this.handleNodeClick,joinValues:p,extractValue:c,delimiter:h,placeholder:H(F),options:R||G?Ve:g,highlightTxt:R||G?je:k,multiple:T,initiallyOpen:A,unfoldedLevel:v,withChildren:b,onlyChildren:S,onlyLeaf:O,hideRoot:D,rootLabel:H(K),rootValue:te,showIcon:ie,showRadio:re,showOutline:ae,autoCheckChildren:X,autoCancelParent:Z,cascade:ee,foldedField:"collapsed",value:a||"",nodePath:Fe,enableNodePath:l,pathSeparator:u,selfDisabledAffectChildren:!1,onAdd:oe,creatable:ne,createTip:le,rootCreatable:fe,rootCreateTip:ge,onEdit:de,editable:ue,editTip:pe,removable:ce,removeTip:ve,onDelete:me,bultinCUD:!se&&!he,onDeferLoad:Te,onExpandTree:Ae,virtualThreshold:_e,height:Le,itemHeight:Y(P)>0?Y(P):void 0,itemRender:Ie?this.renderOptionItem:void 0,enableDefaultIcon:Ee,mobileUI:xe,nodeBehavior:Re,itemActionsRender:ke?this.renderItemActions:void 0,actionClassName:B(Ye(C(C({},this.props),{name:"actionControlClassName",id:z,themeCss:$}))),testIdBuilder:w==null?void 0:w.getChild("tree")});return m.createElement(m.Fragment,null,m.createElement("div",C({ref:this.rootRef,className:B("".concat(r,"TreeControl"),t,i,{"is-sticky":R&&(V==null?void 0:V.sticky),"h-auto":we})},w==null?void 0:w.getChild("control").getTestId()),m.createElement(qe,{size:"sm",key:"info",show:I,loadingConfig:Se}),I?null:R?m.createElement(m.Fragment,null,this.renderSearch(),J):J),m.createElement(Ke,C({},this.props,{config:{wrapperCustomStyle:Ne,id:z,themeCss:$,classNames:[{key:"actionControlClassName"}]},env:De})))},o.defaultProps={placeholder:"placeholder.noData",multiple:!1,rootLabel:"Tree.root",rootValue:"",showIcon:!0,enableNodePath:!1,pathSeparator:"/"},f([_,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],o.prototype,"addItemFromAction",null),f([_,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],o.prototype,"editItemFromAction",null),f([_,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],o.prototype,"deleteItemFromAction",null),f([_,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],o.prototype,"handleChange",null),f([_,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],o.prototype,"handleNodeClick",null),f([_,s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",void 0)],o.prototype,"domRef",null),f([_,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],o.prototype,"renderOptionItem",null),f([_,s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",void 0)],o.prototype,"renderItemActions",null),f([_,s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",void 0)],o.prototype,"renderSearch",null),f([Xe(),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",void 0)],o.prototype,"render",null),o}(m.Component),ot=function(E){q(o,E);function o(){return E!==null&&E.apply(this,arguments)||this}return o=f([Ze({type:"input-tree"})],o),o}(rt);export{ot as TreeControlRenderer,rt as default};
